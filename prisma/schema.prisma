generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  poster
  mod
  master
}

enum Action {
  create_space
  delete_space
  create_discussion
  delete_discussion
  create_post
  delete_post
  update_post
  ban_ip_permanent
  ban_ip
  unban_ip
  announcement
}

model Poster {
  id         String   @id @default(cuid())
  email      String   @unique
  name       String
  passw      String
  role       Role     @default(poster)
  created_at DateTime @default(now())

  posts            Post[]
  discussions      Discussion[]
  spaces_moderated Space[]      @relation("Spacemods")

  mod_log     Activity[]
  infractions Activity[] @relation("UserInfractions")
}

model Activity {
  id         String   @id @default(cuid())
  action     Action
  desc       String?
  created_at DateTime @default(now())
  meta       Json?

  mod_id    String
  moderator Poster @relation(fields: [mod_id], references: [id])

  target_id String?
  target    Poster? @relation("UserInfractions", fields: [target_id], references: [id])

  space_id String?
  space    Space?  @relation(fields: [space_id], references: [id])
}

model Space {
  id         String   @id @default(cuid())
  key        String
  desc       String
  contained  Boolean  @default(false)
  created_at DateTime @default(now())

  moderators  Poster[]     @relation("Spacemods")
  discussions Discussion[]
  mod_log     Activity[]
}

model Discussion {
  id         String   @id @default(cuid())
  title      String
  desc       String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  url        String?

  space_id String
  space    Space  @relation(fields: [space_id], references: [id])

  creator_id String?
  creator    Poster? @relation(fields: [creator_id], references: [id])
  name       String  @default("Unknown")
  trip       String?

  posts Post[]
}

model Post {
  id         String   @id @default(cuid())
  content    String
  url        String?
  created_at DateTime @default(now())

  discussion_id String
  discussion    Discussion @relation(fields: [discussion_id], references: [id], onDelete: Cascade)

  poster_id String?
  poster    Poster? @relation(fields: [poster_id], references: [id], onDelete: Cascade)
  name      String  @default("Unknown")
  trip      String?
}
